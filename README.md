# Simple HTTP Server

ä¸€ä¸ªä½¿ç”¨ C++ å¼€å‘çš„è½»é‡çº§ HTTP æ–‡ä»¶æœåŠ¡å™¨ï¼ŒåŸºäº [cpp-httplib](https://github.com/yhirose/cpp-httplib) åº“å®ç°ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- âœ… é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆä» `assets` ç›®å½•ï¼‰
- âœ… æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼ˆmultipart/form-dataï¼‰
- âœ… æ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢ï¼ˆå«å¤§å°ã€ä¸Šä¼ æ—¶é—´ã€åˆ é™¤ç ï¼‰
- âœ… æ–‡ä»¶é¢„è§ˆåŠŸèƒ½ï¼ˆå›¾ç‰‡/è§†é¢‘æ™ºèƒ½è¯†åˆ«ï¼‰
- âœ… æ–‡ä»¶åˆ é™¤åŠŸèƒ½ï¼ˆåŸºäºåˆ é™¤ç ï¼‰
- âœ… æ–‡ä»¶å…ƒæ•°æ®æŒä¹…åŒ–å­˜å‚¨
- âœ… RESTful API æ¥å£
- âœ… è‡ªåŠ¨è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼ˆContent-Typeï¼‰
- âœ… è·¯å¾„éå†æ”»å‡»é˜²æŠ¤
- âœ… æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆ100MBï¼‰
- âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆJSON æ ¼å¼ï¼‰
- âœ… è·¨å¹³å°æ”¯æŒï¼ˆWindowsï¼‰
- âœ… æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼ï¼ˆHTML, CSS, JS, JSON, å›¾ç‰‡ã€è§†é¢‘ç­‰ï¼‰

## ğŸš€ API æ¥å£

### 1. æµ‹è¯•æ¥å£

```
GET /api/test
```

è¿”å›ç¤ºä¾‹ï¼š

```json
{ "data": "success" }
```

### 2. æ–‡ä»¶ä¸Šä¼ æ¥å£

```
POST /api/file-upload
Content-Type: multipart/form-data
```

å‚æ•°ï¼š

- `file`: ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆå­—æ®µåå¿…é¡»ä¸º "file"ï¼‰

é™åˆ¶ï¼š

- æœ€å¤§æ–‡ä»¶å¤§å°ï¼š2GB
- æ–‡ä»¶åä¸èƒ½åŒ…å«è·¯å¾„åˆ†éš”ç¬¦ï¼ˆ`/`ã€`\`ã€`..`ï¼‰
- å¦‚æœæ–‡ä»¶å·²å­˜åœ¨ï¼Œå°†è¿”å› 409 é”™è¯¯

è¿”å›ç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰ï¼š

```json
{
  "success": true,
  "filename": "example.png",
  "size": 12345,
  "uploadTime": "2025-11-03T14:30:25",
  "code": "a8K9xP2m",
  "path": "/api/file-get?name=example.png"
}
```

**å­—æ®µè¯´æ˜ï¼š**

- `code`: åˆ é™¤ç ï¼ˆ8 ä½å­—æ¯æ•°å­—ç»„åˆï¼‰ï¼Œç”¨äºåˆ é™¤æ–‡ä»¶ï¼Œè¯·å¦¥å–„ä¿ç®¡

è¿”å›ç¤ºä¾‹ï¼ˆå¤±è´¥ï¼‰ï¼š

```json
{
  "error": "File already exists"
}
```

**ä½¿ç”¨ curl ç¤ºä¾‹ï¼š**

```bash
curl -X POST -F "file=@/path/to/your/file.png" http://localhost:8080/api/file-upload
```

**ä½¿ç”¨ JavaScript fetch ç¤ºä¾‹ï¼š**

```javascript
const formData = new FormData();
formData.append("file", fileInput.files[0]);

fetch("http://localhost:8080/api/file-upload", {
  method: "POST",
  body: formData,
})
  .then((response) => response.json())
  .then((data) => console.log(data));
```

### 3. æ–‡ä»¶åˆ—è¡¨æ¥å£

```
GET /api/file-list
```

è·å–æ‰€æœ‰å·²ä¸Šä¼ æ–‡ä»¶çš„ä¿¡æ¯åˆ—è¡¨ã€‚

è¿”å›ç¤ºä¾‹ï¼š

```json
{
  "success": true,
  "data": [
    {
      "filename": "pic.png",
      "size": 12345,
      "uploadTime": "2025-11-03T14:30:25",
      "code": "a8K9xP2m"
    },
    {
      "filename": "document.pdf",
      "size": 54321,
      "uploadTime": "2025-11-03T15:45:10",
      "code": "b7L3qR9n"
    }
  ]
}
```

å­—æ®µè¯´æ˜ï¼š

- `success`: è¯·æ±‚æ˜¯å¦æˆåŠŸ
- `data`: æ–‡ä»¶åˆ—è¡¨æ•°ç»„
  - `filename`: æ–‡ä»¶å
  - `size`: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  - `uploadTime`: ä¸Šä¼ æ—¶é—´ï¼ˆISO 8601 æ ¼å¼ï¼‰
  - `code`: åˆ é™¤ç ï¼ˆç”¨äºåˆ é™¤æ–‡ä»¶ï¼‰

**ä½¿ç”¨ curl ç¤ºä¾‹ï¼š**

```bash
curl http://localhost:8080/api/file-list
```

**ä½¿ç”¨ JavaScript fetch ç¤ºä¾‹ï¼š**

```javascript
fetch("http://localhost:8080/api/file-list")
  .then((response) => response.json())
  .then((result) => {
    if (result.success) {
      result.data.forEach((file) => {
        console.log(
          `${file.filename} - ${file.size} bytes - ${file.uploadTime}`
        );
      });
    }
  });
```

### 4. æ–‡ä»¶åˆ é™¤æ¥å£

```
DELETE /api/file-delete?code=<delete_code>
```

é€šè¿‡åˆ é™¤ç åˆ é™¤æ–‡ä»¶åŠå…¶å…ƒæ•°æ®ã€‚

å‚æ•°ï¼š

- `code`: åˆ é™¤ç ï¼ˆ8 ä½å­—æ¯æ•°å­—ç»„åˆï¼Œä¸Šä¼ æ–‡ä»¶æ—¶è¿”å›ï¼‰

è¿”å›ç¤ºä¾‹ï¼ˆæˆåŠŸï¼‰ï¼š

```json
{
  "success": true,
  "filename": "example.png"
}
```

è¿”å›ç¤ºä¾‹ï¼ˆå¤±è´¥ï¼‰ï¼š

```json
{
  "error": "File not found or code invalid"
}
```

**ä½¿ç”¨ curl ç¤ºä¾‹ï¼š**

```bash
curl -X DELETE "http://localhost:8080/api/file-delete?code=a8K9xP2m"
```

**ä½¿ç”¨ JavaScript fetch ç¤ºä¾‹ï¼š**

```javascript
fetch("http://localhost:8080/api/file-delete?code=a8K9xP2m", {
  method: "DELETE",
})
  .then((response) => response.json())
  .then((data) => console.log(data));
```

**æ³¨æ„äº‹é¡¹ï¼š**

- âš ï¸ åˆ é™¤æ“ä½œä¸å¯æ¢å¤
- ğŸ”’ åˆ é™¤ç æ˜¯å”¯ä¸€å‡­è¯ï¼Œè¯·å¦¥å–„ä¿ç®¡
- âœ… åˆ é™¤æ–‡ä»¶çš„åŒæ—¶ä¼šè‡ªåŠ¨æ›´æ–°å…ƒæ•°æ®åˆ—è¡¨

### 5. æ–‡ä»¶é¢„è§ˆæ¥å£

```
GET /api/file-preview?code=<delete_code>
```

é€šè¿‡åˆ é™¤ç è·å–æ–‡ä»¶é¢„è§ˆä¿¡æ¯ï¼Œæ ¹æ®æ–‡ä»¶ç±»å‹è¿”å›ä¸åŒçš„å“åº”ã€‚

å‚æ•°ï¼š

- `code`: åˆ é™¤ç ï¼ˆ8 ä½å­—æ¯æ•°å­—ç»„åˆï¼Œä¸Šä¼ æ–‡ä»¶æ—¶è¿”å›ï¼‰

è¿”å›ç¤ºä¾‹ï¼ˆå›¾ç‰‡æ–‡ä»¶ï¼‰ï¼š

```json
{
  "filename": "pic.png",
  "type": "image",
  "size": 12345,
  "url": "/api/file-get?name=pic.png"
}
```

è¿”å›ç¤ºä¾‹ï¼ˆè§†é¢‘æ–‡ä»¶ï¼‰ï¼š

```json
{
  "filename": "video.mp4",
  "type": "video",
  "size": 1234567,
  "url": "/api/file-get?name=video.mp4"
}
```

è¿”å›ç¤ºä¾‹ï¼ˆå…¶ä»–æ–‡ä»¶ï¼‰ï¼š

```json
{
  "filename": "document.pdf",
  "type": "other",
  "size": 54321,
  "url": ""
}
```

**å­—æ®µè¯´æ˜ï¼š**

- `filename`: æ–‡ä»¶å
- `type`: æ–‡ä»¶ç±»å‹ï¼ˆ`image` / `video` / `other`ï¼‰
- `size`: æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
- `url`: é¢„è§ˆ URLï¼ˆä»…å›¾ç‰‡å’Œè§†é¢‘æœ‰å€¼ï¼Œå…¶ä»–ç±»å‹ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰

**æ”¯æŒçš„æ ¼å¼ï¼š**

- **å›¾ç‰‡**ï¼š`.png`, `.jpg`, `.jpeg`, `.gif`, `.bmp`, `.webp`, `.svg`, `.ico`
- **è§†é¢‘**ï¼š`.mp4`, `.avi`, `.mov`, `.wmv`, `.flv`, `.webm`, `.mkv`, `.m4v`, `.3gp`, `.mpg`, `.mpeg`
- **å…¶ä»–**ï¼šæ‰€æœ‰å…¶ä»–æ ¼å¼è¿”å› `type: "other"` ä¸” `url: ""`

**ä½¿ç”¨ curl ç¤ºä¾‹ï¼š**

```bash
curl "http://localhost:8080/api/file-preview?code=a8K9xP2m"
```

**ä½¿ç”¨ JavaScript fetch ç¤ºä¾‹ï¼š**

```javascript
fetch("http://localhost:8080/api/file-preview?code=a8K9xP2m")
  .then((response) => response.json())
  .then((data) => {
    if (data.type === "image" || data.type === "video") {
      console.log("Preview URL:", data.url);
      // å¯ä»¥ç›´æ¥ç”¨äº <img> æˆ– <video> æ ‡ç­¾
      // <img src={data.url} />
    } else {
      console.log("No preview available for this file type");
    }
  });
```

**å®‰å…¨æ€§è¯´æ˜ï¼š**

- ğŸ”’ åªæœ‰æ‹¥æœ‰åˆ é™¤ç çš„ç”¨æˆ·æ‰èƒ½é¢„è§ˆæ–‡ä»¶
- âœ… é˜²æ­¢æœªæˆæƒè®¿é—®
- âœ… æ”¯æŒç§å¯†æ–‡ä»¶åˆ†äº«

### 6. æ–‡ä»¶è·å–æ¥å£

```
GET /api/file-get?name=<filename>
```

å‚æ•°ï¼š

- `name`: æ–‡ä»¶åï¼ˆä»…å…è®¸æ–‡ä»¶åï¼Œä¸å…è®¸è·¯å¾„ï¼‰

ç¤ºä¾‹ï¼š

```
http://localhost:8080/api/file-get?name=pic.png
```

**ä½¿ç”¨ curl ç¤ºä¾‹ï¼š**

```bash
curl "http://localhost:8080/api/file-get?name=pic.png"
```

## ğŸ› ï¸ ç¯å¢ƒè¦æ±‚

### å¿…éœ€è½¯ä»¶

1. **C++ ç¼–è¯‘å™¨ï¼ˆg++ï¼‰**

   - æ¨èä½¿ç”¨ [MSYS2](https://www.msys2.org/) (Windows)
   - æˆ–è€… MinGW-w64 / TDM-GCC
   - éœ€è¦æ”¯æŒ C++17 æ ‡å‡†

2. **clangd**ï¼ˆå¯é€‰ï¼Œç”¨äºä»£ç æ™ºèƒ½æç¤ºï¼‰

   - ä» [LLVM Release](https://github.com/llvm/llvm-project/releases) ä¸‹è½½
   - æˆ–ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…

3. **Make**ï¼ˆå¯é€‰ï¼Œå¦‚æœä½¿ç”¨ Makefile ç¼–è¯‘ï¼‰
   - MSYS2 è‡ªå¸¦
   - æˆ–å•ç‹¬å®‰è£…

### ä¾èµ–åº“

- **cpp-httplib** (è‡ªåŠ¨ä¸‹è½½): HTTP æœåŠ¡å™¨åº“ï¼ˆHeader-Onlyï¼‰
- **nlohmann/json** (å·²åŒ…å«): ç°ä»£ C++ JSON è§£æåº“ï¼ˆHeader-Onlyï¼‰

### ç¯å¢ƒå˜é‡é…ç½®ï¼ˆé‡è¦ï¼ï¼‰

ä¸ºäº†ç¡®ä¿é¡¹ç›®åœ¨ä»»ä½•ç”µè„‘å’Œç»ˆç«¯ï¼ˆCMDã€PowerShellã€VS Codeã€Cursorï¼‰ä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å°†ç¼–è¯‘å·¥å…·æ·»åŠ åˆ°**ç³»ç»Ÿç¯å¢ƒå˜é‡**ä¸­ã€‚

#### Windows ç³»ç»Ÿ PATH é…ç½®æ­¥éª¤

1. **æ‰“å¼€ç¯å¢ƒå˜é‡è®¾ç½®**

   - å³é”® "æ­¤ç”µè„‘" â†’ "å±æ€§"
   - ç‚¹å‡» "é«˜çº§ç³»ç»Ÿè®¾ç½®"
   - ç‚¹å‡» "ç¯å¢ƒå˜é‡"

2. **ç¼–è¾‘ç³»ç»Ÿ PATH å˜é‡**

   - åœ¨ "ç³»ç»Ÿå˜é‡" åŒºåŸŸæ‰¾åˆ° `Path`
   - ç‚¹å‡» "ç¼–è¾‘"
   - ç‚¹å‡» "æ–°å»º" æ·»åŠ ä»¥ä¸‹è·¯å¾„ï¼š

3. **MSYS2 ç”¨æˆ·æ·»åŠ è¿™äº›è·¯å¾„**ï¼ˆæ ¹æ®ä½ çš„å®‰è£…ä½ç½®è°ƒæ•´ï¼‰ï¼š

   ```
   C:\msys64\ucrt64\bin
   C:\msys64\usr\bin
   ```

4. **éªŒè¯é…ç½®**

   é‡å¯ç»ˆç«¯åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š

   ```bash
   # éªŒè¯ g++ å®‰è£…
   g++ --version

   # éªŒè¯ make å®‰è£…
   make --version

   # éªŒè¯ clangd å®‰è£…ï¼ˆå¯é€‰ï¼‰
   clangd --version
   ```

   âœ… å¦‚æœæ‰€æœ‰å‘½ä»¤éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºç‰ˆæœ¬å·ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼

#### ä¸ºä»€ä¹ˆè¦é…ç½®ç³»ç»Ÿ PATHï¼Ÿ

- âœ… **è·¨å¹³å°å…¼å®¹**ï¼šåœ¨ä»»ä½•ç»ˆç«¯ä¸­éƒ½èƒ½ä½¿ç”¨
- âœ… **è·¨é¡¹ç›®é€šç”¨**ï¼šé…ç½®ä¸€æ¬¡ï¼Œæ‰€æœ‰ C++ é¡¹ç›®éƒ½èƒ½ç”¨
- âœ… **å›¢é˜Ÿåä½œ**ï¼šæ¯ä¸ªäººåœ¨è‡ªå·±ç”µè„‘ä¸Šé…ç½®åï¼Œé¡¹ç›®ä»£ç æ— éœ€ä¿®æ”¹
- âœ… **IDE é›†æˆ**ï¼šVS Codeã€Cursorã€CLion ç­‰ IDE éƒ½èƒ½æ­£ç¡®è¯†åˆ«

#### Cursor / VS Code ç»ˆç«¯é—®é¢˜æ’æŸ¥

å¦‚æœé…ç½®äº†ç³»ç»Ÿ PATH ä½† Cursor ç»ˆç«¯ä»ç„¶æ‰¾ä¸åˆ°å‘½ä»¤ï¼š

1. **å®Œå…¨é‡å¯ Cursor**ï¼ˆä¸æ˜¯é‡æ–°åŠ è½½çª—å£ï¼‰
2. **æ£€æŸ¥ç»ˆç«¯ç±»å‹**ï¼šç¡®ä¿ä½¿ç”¨çš„æ˜¯ PowerShell æˆ– CMD
3. **æ‰‹åŠ¨æµ‹è¯•**ï¼šåœ¨æ–°ç»ˆç«¯ä¸­è¿è¡Œ `$env:PATH` (PowerShell) æˆ– `echo %PATH%` (CMD) æŸ¥çœ‹è·¯å¾„

## ğŸ“¦ å®‰è£…ä¸ç¼–è¯‘

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd ser
```

### 2. ç¼–è¯‘é¡¹ç›®

é¡¹ç›®ä¾èµ–å·²åŒ…å«åœ¨ `three-party/include/` ç›®å½•ä¸­ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚

#### æ–¹æ³• Aï¼šä½¿ç”¨ Makefileï¼ˆæ¨èï¼‰

```bash
make
```

Makefile ä¼šè‡ªåŠ¨æ”¶é›† `src/` ç›®å½•ä¸‹æ‰€æœ‰ `.cpp` æ–‡ä»¶å¹¶ç¼–è¯‘ã€‚

#### æ–¹æ³• Bï¼šæ‰‹åŠ¨ç¼–è¯‘

```bash
# åˆ›å»ºè¾“å‡ºç›®å½•
mkdir -p bin

# ç¼–è¯‘ï¼ˆè‡ªåŠ¨åŒ…å«æ‰€æœ‰æ¨¡å—ï¼‰
g++ -std=c++17 -O2 -Wall -Wextra -Ithree-party/include -D_WIN32_WINNT=0x0A00 \
    src/*.cpp src/**/*.cpp \
    -o bin/simple_http_server.exe -lws2_32
```

#### æ–¹æ³• Cï¼šä½¿ç”¨ VS Code / Cursor

å®‰è£… Code Runner æ‰©å±•åï¼Œç›´æ¥ç‚¹å‡»ç¼–è¾‘å™¨å³ä¸Šè§’çš„è¿è¡ŒæŒ‰é’® â–¶ï¸

## ğŸƒ è¿è¡Œ

### ä½¿ç”¨ Makefile

```bash
make run
```

### ç›´æ¥è¿è¡Œ

```bash
./bin/simple_http_server.exe
```

æœåŠ¡å™¨å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š

```
HTTP server listening on http://0.0.0.0:8080
Available endpoints:
  GET    /api/test
  POST   /api/file-upload
  GET    /api/file-get?name=<filename>
  GET    /api/file-list
  DELETE /api/file-delete?code=<code>
```

### æœåŠ¡å™¨ä¿¡æ¯

- é»˜è®¤ç«¯å£ï¼š`8080`
- ç›‘å¬åœ°å€ï¼š`0.0.0.0`ï¼ˆæ‰€æœ‰ç½‘ç»œæ¥å£ï¼‰
- è®¿é—®åœ°å€ï¼š`http://localhost:8080`

## ğŸ“ é¡¹ç›®ç»“æ„

```
ser/
â”œâ”€â”€ assets/                  # é™æ€æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ pic.png
â”‚   â”œâ”€â”€ arrow-right.svg
â”‚   â”œâ”€â”€ .file_metadata.json  # æ–‡ä»¶å…ƒæ•°æ®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ ...
â”œâ”€â”€ bin/                     # ç¼–è¯‘è¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ simple_http_server.exe
â”œâ”€â”€ src/                     # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ main.cpp            # ä¸»ç¨‹åºå…¥å£ï¼ˆæœåŠ¡å™¨åˆå§‹åŒ–ï¼‰
â”‚   â”œâ”€â”€ routes.h/cpp        # æ€»è·¯ç”±é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ file/               # æ–‡ä»¶æ“ä½œæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ file_routes.h/cpp   # æ–‡ä»¶è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ file_handlers.h/cpp # æ–‡ä»¶è¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ file_manager.h/cpp  # æ–‡ä»¶å…ƒæ•°æ®ç®¡ç†
â”‚   â””â”€â”€ test/               # æµ‹è¯•æ¨¡å—
â”‚       â”œâ”€â”€ test_routes.h/cpp   # æµ‹è¯•è·¯ç”±é…ç½®
â”‚       â””â”€â”€ test_handlers.h/cpp # æµ‹è¯•è¯·æ±‚å¤„ç†å™¨
â”œâ”€â”€ three-party/             # ç¬¬ä¸‰æ–¹åº“
â”‚   â”œâ”€â”€ cpp-httplib/        # httplib æºç ï¼ˆè‡ªåŠ¨ä¸‹è½½ï¼‰
â”‚   â””â”€â”€ include/            # å¤´æ–‡ä»¶ç›®å½•ï¼ˆHeader-Only åº“ï¼‰
â”‚       â”œâ”€â”€ httplib.h       # HTTP æœåŠ¡å™¨åº“
â”‚       â””â”€â”€ json.hpp        # JSON è§£æåº“ï¼ˆnlohmann/jsonï¼‰
â”œâ”€â”€ .vscode/                 # VS Code / Cursor é…ç½®
â”‚   â”œâ”€â”€ settings.json
â”‚   â””â”€â”€ c_cpp_properties.json
â”œâ”€â”€ .gitignore
â”œâ”€â”€ Makefile
â”œâ”€â”€ compile_commands.json
â””â”€â”€ README.md
```

## ğŸ—ï¸ ä»£ç æ¶æ„

é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ï¼š

### æ¨¡å—åˆ’åˆ†ï¼ˆæŒ‰åŠŸèƒ½åˆ†ç»„ï¼‰

#### 1. **main.cpp** - ä¸»ç¨‹åºå…¥å£ (~20 è¡Œ)

- åˆ›å»ºæœåŠ¡å™¨å®ä¾‹
- é…ç½®æœåŠ¡å™¨å‚æ•°
- å¯åŠ¨æœåŠ¡å™¨ç›‘å¬

#### 2. **routes** - æ€»è·¯ç”±é…ç½®å±‚ (~10 è¡Œ)

- `configure_routes()` - ç»„åˆæ‰€æœ‰å­æ¨¡å—è·¯ç”±
- ä½œä¸ºè·¯ç”±æ³¨å†Œçš„å…¥å£ç‚¹

#### 3. **file æ¨¡å—** - æ–‡ä»¶æ“ä½œåŠŸèƒ½

**file_routes.cpp** (~10 è¡Œ)

- `configure_file_routes()` - é…ç½®æ–‡ä»¶ç›¸å…³è·¯ç”±

**file_handlers.cpp** (~230 è¡Œ)

- `handle_file_upload()` - æ–‡ä»¶ä¸Šä¼ å¤„ç†
- `handle_file_get()` - æ–‡ä»¶ä¸‹è½½å¤„ç†
- `handle_file_list()` - æ–‡ä»¶åˆ—è¡¨æŸ¥è¯¢
- `handle_file_delete_by_code()` - æ–‡ä»¶åˆ é™¤å¤„ç†
- `get_content_type()` - MIME ç±»å‹è¯†åˆ«
- `is_valid_filename()` - æ–‡ä»¶åå®‰å…¨éªŒè¯

**file_manager.cpp** (~205 è¡Œ)

- `save_file_metadata()` - ä¿å­˜æ–‡ä»¶å…ƒæ•°æ®
- `delete_file_by_code()` - åˆ é™¤æ–‡ä»¶åŠå…ƒæ•°æ®
- `read_file_metadata()` - è¯»å–å…ƒæ•°æ®åˆ—è¡¨
- `generate_delete_code()` - ç”Ÿæˆåˆ é™¤ç 
- `get_current_timestamp()` - æ—¶é—´æˆ³ç”Ÿæˆ

#### 4. **test æ¨¡å—** - æµ‹è¯•åŠŸèƒ½

**test_routes.cpp** (~7 è¡Œ)

- `configure_test_routes()` - é…ç½®æµ‹è¯•ç›¸å…³è·¯ç”±

**test_handlers.cpp** (~9 è¡Œ)

- `handle_test()` - æµ‹è¯•æ¥å£å¤„ç†

#### 5. **nlohmann/json** - JSON è§£æåº“

- ç°ä»£ C++ JSON åº“
- è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼ˆRAIIï¼‰
- ç±»å‹å®‰å…¨
- ç®€æ´çš„ API

### æ¶æ„å±‚æ¬¡ï¼ˆæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              main.cpp (å…¥å£å±‚ ~20è¡Œ)                     â”‚
â”‚            - æœåŠ¡å™¨å®ä¾‹åŒ–å’Œé…ç½®                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            routes.cpp (è·¯ç”±èšåˆå±‚ ~10è¡Œ)                 â”‚
â”‚            - ç»„åˆæ‰€æœ‰åŠŸèƒ½æ¨¡å—è·¯ç”±                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  FILE æ¨¡å—      â”‚          â”‚   TEST æ¨¡å—        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  file_routes     â”‚          â”‚  test_routes     â”‚
    â”‚    (~10è¡Œ)       â”‚          â”‚    (~7è¡Œ)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  file_handlers   â”‚          â”‚  test_handlers   â”‚
    â”‚    (~230è¡Œ)      â”‚          â”‚    (~9è¡Œ)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  file_manager    â”‚
    â”‚    (~205è¡Œ)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¨¡å—åŒ–ä¼˜åŠ¿ï¼š**

- æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹æˆæ¨¡å—ï¼ˆfileã€testï¼‰
- æ–°å¢åŠŸèƒ½ï¼ˆå¦‚ userã€authï¼‰åªéœ€æŒ‰ç›¸åŒæ¨¡å¼æ·»åŠ 
- è·¯ç”±ã€å¤„ç†å™¨ã€ä¸šåŠ¡é€»è¾‘å®Œå…¨è§£è€¦

### æ¶æ„ä¼˜åŠ¿

**ä¼˜åŠ¿ï¼š**

- âœ… **åŠŸèƒ½æ¨¡å—åŒ–**ï¼šæŒ‰ä¸šåŠ¡åŠŸèƒ½ï¼ˆfileã€testï¼‰ç»„ç»‡ä»£ç 
- âœ… **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªé¢†åŸŸ
- âœ… **ä½è€¦åˆ**ï¼šæ¨¡å—é—´å®Œå…¨ç‹¬ç«‹ï¼Œé€šè¿‡å¤´æ–‡ä»¶æ¥å£é€šä¿¡
- âœ… **é«˜å†…èš**ï¼šç›¸å…³åŠŸèƒ½ï¼ˆroutes+handlers+businessï¼‰é›†ä¸­åœ¨åŒä¸€æ¨¡å—
- âœ… **æ˜“æµ‹è¯•**ï¼šå¯ç‹¬ç«‹æµ‹è¯•æ¯ä¸ªåŠŸèƒ½æ¨¡å—
- âœ… **æ˜“æ‰©å±•**ï¼šæ·»åŠ æ–°åŠŸèƒ½åªéœ€åˆ›å»ºæ–°æ¨¡å—ï¼ˆå¦‚ user_routes + user_handlersï¼‰
- âœ… **æ˜“ç»´æŠ¤**ï¼šç»“æ„æ¸…æ™°ï¼Œmain.cpp æåº¦ç®€æ´
- âœ… **å›¢é˜Ÿåä½œ**ï¼šä¸åŒå¼€å‘è€…å¯ç‹¬ç«‹å¼€å‘ä¸åŒæ¨¡å—

## ğŸ”§ å¼€å‘ç¯å¢ƒé…ç½®

### VS Code / Cursor

é¡¹ç›®å·²é…ç½®å¥½å¼€å‘ç¯å¢ƒï¼Œå¼€ç®±å³ç”¨ï¼š

1. **ä»£ç æ™ºèƒ½æç¤º**ï¼šç”± clangd æä¾›
2. **ä¸€é”®è¿è¡Œ**ï¼šä½¿ç”¨ Code Runner æ‰©å±•
3. **ç¼–è¯‘æ•°æ®åº“**ï¼š`compile_commands.json`
4. **æ¨¡å—åŒ–è®¾è®¡**ï¼šä»£ç åˆ†ç¦»ï¼Œæ˜“äºæ‰©å±•

### clangd é…ç½®

å¦‚æœä»£ç æç¤ºæœ‰é—®é¢˜ï¼Œè¯·ç¡®ä¿ï¼š

1. clangd å·²å®‰è£…å¹¶åœ¨ PATH ä¸­
2. é‡å¯ clangd è¯­è¨€æœåŠ¡å™¨ï¼š
   - `Ctrl+Shift+P` â†’ è¾“å…¥ "clangd: Restart language server"

## ğŸ§¹ æ¸…ç†

### æ¸…ç†ç¼–è¯‘æ–‡ä»¶

```bash
make clean
```

### å®Œå…¨æ¸…ç†ï¼ˆåŒ…æ‹¬ç¬¬ä¸‰æ–¹åº“ï¼‰

```bash
make distclean
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **è·¯å¾„éå†é˜²æŠ¤**ï¼šé˜»æ­¢ `../`ã€`/` å’Œ `\` ç­‰è·¯å¾„åˆ†éš”ç¬¦
- **æ–‡ä»¶ç±»å‹éªŒè¯**ï¼šåªå…è®¸è®¿é—® `assets` ç›®å½•ä¸‹çš„æ–‡ä»¶
- **æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥**ï¼šè¿”å› 404 é”™è¯¯è€Œéæš´éœ²æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯
- **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼šé™åˆ¶ä¸Šä¼ æ–‡ä»¶æœ€å¤§ 100MB
- **æ–‡ä»¶åéªŒè¯**ï¼šé˜²æ­¢æ¶æ„æ–‡ä»¶åæ³¨å…¥
- **é‡å¤æ–‡ä»¶æ£€æµ‹**ï¼šé˜²æ­¢æ„å¤–è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶
- **ç»Ÿä¸€é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰é”™è¯¯è¿”å›æ ‡å‡† JSON æ ¼å¼

## âš ï¸ é”™è¯¯å¤„ç†

æœåŠ¡å™¨å¯¹æ‰€æœ‰é”™è¯¯éƒ½è¿”å›æ ‡å‡† JSON æ ¼å¼ï¼š

### 404 - æ¥å£ä¸å­˜åœ¨

```json
{
  "error": "API endpoint not found",
  "path": "/api/unknown",
  "method": "GET"
}
```

### 405 - æ–¹æ³•ä¸å…è®¸

```json
{
  "error": "Method not allowed",
  "path": "/api/file-list",
  "method": "POST"
}
```

### 500 - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

```json
{
  "error": "Internal server error",
  "status": 500
}
```

## ğŸ“ æ”¯æŒçš„æ–‡ä»¶ç±»å‹

| æ‰©å±•å          | Content-Type             |
| --------------- | ------------------------ |
| `.html`, `.htm` | text/html                |
| `.css`          | text/css                 |
| `.js`           | application/javascript   |
| `.json`         | application/json         |
| `.png`          | image/png                |
| `.jpg`, `.jpeg` | image/jpeg               |
| `.gif`          | image/gif                |
| `.svg`          | image/svg+xml            |
| `.txt`          | text/plain               |
| å…¶ä»–            | application/octet-stream |

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q: ç¼–è¯‘æ—¶æ‰¾ä¸åˆ° `httplib.h` æˆ– `json.hpp`ï¼Ÿ

A: ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å­˜åœ¨ï¼š

- `three-party/include/httplib.h` - [ä¸‹è½½åœ°å€](https://raw.githubusercontent.com/yhirose/cpp-httplib/master/httplib.h)
- `three-party/include/json.hpp` - [ä¸‹è½½åœ°å€](https://github.com/nlohmann/json/releases)

### Q: clangd æŠ¥é”™æ‰¾ä¸åˆ°æ ‡å‡†åº“å¤´æ–‡ä»¶ï¼Ÿ

A: ç¡®ä¿ g++ åœ¨ PATH ä¸­ï¼Œç„¶åé‡å¯ clangd è¯­è¨€æœåŠ¡å™¨ã€‚

### Q: ç«¯å£ 8080 è¢«å ç”¨ï¼Ÿ

A: ä¿®æ”¹ `src/main.cpp` ä¸­çš„ `PORT` å®å®šä¹‰ã€‚

### Q: Windows ç¼–è¯‘æ—¶é“¾æ¥é”™è¯¯ï¼Ÿ

A: ç¡®ä¿æ·»åŠ äº† `-lws2_32` é“¾æ¥é€‰é¡¹ï¼ˆé“¾æ¥ Windows Socket åº“ï¼‰ã€‚

### Q: è¯·æ±‚ä¸å­˜åœ¨çš„æ¥å£è¿”å›ä»€ä¹ˆï¼Ÿ

A: è¿”å›æ ‡å‡† JSON é”™è¯¯å“åº”ï¼š

```json
{
  "error": "API endpoint not found",
  "path": "/api/unknown",
  "method": "GET"
}
```

## ğŸ“„ è®¸å¯è¯

[åœ¨æ­¤æ·»åŠ æ‚¨çš„è®¸å¯è¯ä¿¡æ¯]

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ”— ç›¸å…³é“¾æ¥

- [cpp-httplib](https://github.com/yhirose/cpp-httplib) - HTTP åº“æ–‡æ¡£
- [nlohmann/json](https://github.com/nlohmann/json) - ç°ä»£ C++ JSON åº“
- [MSYS2](https://www.msys2.org/) - Windows å¼€å‘ç¯å¢ƒ
- [clangd](https://clangd.llvm.org/) - è¯­è¨€æœåŠ¡å™¨

## ğŸ“Š API è·¯ç”±æ€»è§ˆ

| HTTP æ–¹æ³• | è·¯ç”±                | åŠŸèƒ½             | å‚æ•°               |
| --------- | ------------------- | ---------------- | ------------------ |
| GET       | `/api/test`         | æµ‹è¯•æ¥å£         | æ—                  |
| POST      | `/api/file-upload`  | ä¸Šä¼ æ–‡ä»¶         | `file` (multipart) |
| GET       | `/api/file-list`    | è·å–æ–‡ä»¶åˆ—è¡¨     | æ—                  |
| GET       | `/api/file-preview` | è·å–æ–‡ä»¶é¢„è§ˆä¿¡æ¯ | `code` (query)     |
| GET       | `/api/file-get`     | ä¸‹è½½æ–‡ä»¶         | `name` (query)     |
| DELETE    | `/api/file-delete`  | åˆ é™¤æ–‡ä»¶         | `code` (query)     |
